try:
    from flask_restplus import Api, Resource, fields, marshal, jsonify
except ImportError:
    import werkzeug
    werkzeug.cached_property = werkzeug.utils.cached_property
    from flask_restplus import Resource, Api, fields, marshal

import json
from sklearn.feature_extraction.text import CountVectorizer
import pandas as pd
import joblib
import sys
import os

def predice_GENEROS(plot):

    clf = joblib.load(os.path.dirname(__file__) + '/modelo_predice_generos.pkl') 
    
    vocabulario= {'most': 589, 'is': 451, 'the': 871, 'story': 831, 'of': 625, 'a': 14, 'single': 795, 'father': 308, 'who': 967, 'takes': 854, 'his': 414, 'year': 993, '-': 8, 'old': 632, 'son': 808, 'to': 891, 'work': 984, 'with': 978, 'him': 410, 'at': 78, 'where': 962, 'he': 396, '.': 9, 'day': 217, 'before': 100, ',': 7, 'boy': 130, 'meets': 567, 'woman': 981, 'train': 904, 'drug': 259, 'goes': 375, 'into': 446, 'room': 740, 'and': 55, 'tells': 865, 'stay': 823, 'ship': 786, 'comes': 186, 'though': 885, 'it': 455, 'arrive': 70, 'an': 54, 'later': 500, 'happens': 389, 'sees': 770, 'this': 883, 'tries': 909, 'not': 620, 'able': 15, 'see': 763, 'just': 475, 'as': 74, 'falls': 302, 'works': 986, 'while': 965, 'leaving': 512, 'then': 875, 'people': 658, 'in': 438, 'are': 65, 'fact': 299, 'died': 237, 'trying': 916, 'save': 752, 'them': 873, 'other': 642, 'than': 869, 'happened': 388, 'look': 531, 'out': 645, 'her': 405, 'movie': 593, 'ends': 274, 'man': 550, 'new': 613, 'city': 176, 'no': 618, 'small': 800, 'baby': 85, 'run': 743, 'one': 636, 'female': 314, 'they': 878, 'all': 43, 'meet': 565, 'film': 320, 'killer': 484, 'decides': 226, 'secrets': 761, 'career': 157, 'store': 829, 'lives': 524, 'beyond': 112, 'means': 563, 'become': 96, 'she': 784, 'love': 540, 'life': 518, 'changes': 165, 'when': 961, 'be': 93, 'wife': 972, 'apartment': 63, 'but': 144, 'believes': 107, 'rather': 705, 'offers': 628, 'chance': 163, 'like': 520, 'again': 31, 'accepts': 17, 'despite': 231, 'meanwhile': 564, 'evil': 293, 'himself': 411, 'person': 660, 'way': 951, 'fortune': 342, 'four': 344, 'york': 996, 'president': 683, 'has': 393, 'had': 384, 'meeting': 566, 'sends': 773, 'six': 798, 'never': 612, 'for': 335, 'after': 30, 'death': 224, 'getting': 365, 'dies': 238, 'on': 634, 'street': 834, 'get': 363, 'money': 585, 'body': 124, 'without': 980, 'george': 361, "'": 4, 's': 747, 'from': 352, 'use': 935, 'information': 441, 'make': 547, 'sell': 772, 'much': 596, 'possible': 678, 'until': 931, 'end': 273, 'back': 86, 'morning': 588, 'by': 146, 'making': 549, 'learn': 508, 'that': 870, 'dead': 220, 'company': 189, 'next': 615, 'seven': 779, 'member': 568, 'board': 120, 'however': 427, '"': 1, 'don': 251, 'there': 876, 'walter': 944, 'married': 555, 'needs': 609, 'n': 603, 'give': 369, 'if': 435, 'near': 607, 'close': 178, 'friend': 349, 'o': 624, 'will': 974, 'responsible': 724, '?': 13, 'los': 535, 'angeles': 56, 'house': 425, 'date': 213, 'lawyer': 503, 'michael': 574, 'powerful': 680, 'accidentally': 19, 'murder': 597, 'robert': 734, 'discover': 242, 'chief': 169, 'martin': 557, 'head': 397, 'convince': 193, 'against': 32, 'murdered': 598, 'take': 852, 'three': 886, 'find': 323, 'kill': 482, 'do': 244, 'know': 489, 'does': 247, 'might': 576, 'office': 629, 'two': 922, 'through': 887, 'town': 902, 'news': 614, 'local': 527, 'been': 99, 'stolen': 827, 'form': 340, 'men': 570, 'determined': 234, 'gay': 359, 'night': 617, 'west': 958, 'hollywood': 418, 'california': 147, 'eddie': 269, 'friends': 350, 'going': 376, 'following': 331, 'encounter': 272, 'sets': 778, 'eye': 296, 'jake': 460, 'bad': 87, 'wants': 947, 'better': 110, 'very': 940, 'you': 997, 'their': 872, 'adult': 27, 'about': 16, 'move': 591, 'away': 84, 'south': 810, 'village': 941, 'entire': 279, 'up': 932, 'which': 964, 'were': 957, 'area': 66, 'yet': 995, 'five': 328, 'brothers': 139, 'being': 105, 'only': 637, 'between': 111, 'also': 48, 'within': 979, 'family': 303, 'its': 456, 'members': 569, 'different': 239, 'role': 737, 'age': 33, 'immediately': 436, 'marry': 556, 'brother': 138, 'front': 353, 'sister': 796, 'mr': 594, 'relationship': 718, 'would': 989, 'did': 235, 'book': 126, 'first': 327, 'experience': 295, 'school': 755, 'result': 726, 'whose': 970, 'leave': 510, 'now': 622, 'even': 285, 'worse': 988, 'want': 945, 'something': 807, 'frank': 346, 'marriage': 554, 'puts': 698, 'middle': 575, 'roy': 742, 'was': 949, 'best': 109, 'world': 987, '(': 5, 'early': 265, ')': 6, 'fellow': 313, 'some': 805, 'leaves': 511, 'hand': 386, '!': 0, 'let': 517, 'down': 253, 'gets': 364, 'becomes': 97, 'really': 712, 'farm': 306, 'convinces': 194, 'll': 526, 'ever': 288, 'seen': 769, 'agrees': 36, 'go': 372, 'road': 733, 'actually': 25, 'finds': 325, 'outside': 646, 'quite': 703, 'soon': 809, 'cross': 204, 'still': 826, 'top': 899, 'have': 394, 'huge': 428, 'both': 129, 'off': 626, 'truly': 913, ':': 11, 'these': 877, 'help': 402, 'buddy': 141, 'survive': 847, 'during': 262, 'adventure': 28, 'why': 971, 'always': 50, 'plans': 668, 'summer': 844, 'good': 378, 'ed': 268, 'car': 155, 'accident': 18, 'teacher': 858, 'put': 697, 'job': 468, 'helps': 403, 'across': 20, 'business': 143, 'makes': 548, 'under': 926, 'what': 959, 'home': 419, 'break': 133, 'steal': 824, 'drive': 257, 'idea': 433, 'whole': 968, 'so': 801, 'owner': 649, 'jail': 459, 'using': 938, 'everything': 291, 'living': 525, 'stand': 816, 'kind': 487, 'guy': 383, 'neighbor': 610, 'mrs': 595, 'can': 152, 'keeps': 478, 'playing': 671, 'winning': 977, 'big': 113, 'last': 498, 'taking': 855, 'girlfriend': 367, 'loves': 542, 'little': 522, 'alone': 45, 'whatever': 960, 'named': 605, '$': 2, 'million': 579, 'having': 395, 'set': 777, 'own': 648, 'time': 889, 'behavior': 103, 'leads': 507, 'believe': 106, 'may': 562, 'appears': 64, 'especially': 282, 'police': 675, 'neighborhood': 611, 'suspect': 849, 'nature': 606, 'others': 643, 'san': 750, 'herself': 407, 'lead': 504, 'same': 749, 'jack': 458, 'actor': 23, 'track': 903, 'situation': 797, 'comedy': 185, 're': 707, 'fate': 307, 'runs': 745, 'attracted': 83, 'elizabeth': 270, 'tv': 920, 'could': 196, 'play': 669, 'series': 775, 'taken': 853, 'seeing': 764, 'whom': 969, 'turns': 919, 'right': 732, 'ways': 952, 'j': 457, 'd': 206, 'u': 923, 'got': 379, 'name': 604, 'stop': 828, 'young': 998, 'boys': 132, 'attention': 82, 'decide': 225, 'bank': 89, 'more': 587, 'great': 381, 'win': 976, 'girls': 368, 'over': 647, 'girl': 366, 'women': 982, 'must': 601, 'american': 52, 'football': 334, ';': 12, 'wealthy': 954, 'calls': 150, 'since': 793, 'real': 708, 'truth': 914, 'working': 985, 'mob': 584, 'daughter': 214, 'mother': 590, 'law': 502, 'because': 95, 'fbi': 309, 'killed': 483, 'turn': 917, 'kid': 479, 'strange': 832, 'white': 966, 'kids': 481, 'ex': 294, 'learns': 509, 'kidnapped': 480, 'come': 184, 'plan': 665, 'how': 426, 'themselves': 874, 'easy': 267, '/': 10, 'mind': 580, 'includes': 439, 'case': 158, 'knows': 492, 'those': 884, 'cia': 175, 'begins': 102, 'london': 528, 'shot': 788, 'ten': 866, 'years': 994, 'russian': 746, 'thinks': 882, 'should': 789, 'told': 893, 'tell': 863, 'anyone': 61, 'including': 440, 'someone': 806, 'instead': 444, 'kills': 486, 'says': 753, 'bring': 135, 'fianc√©e': 316, 'along': 46, 'shows': 791, 'doesn': 248, 't': 851, 'action': 22, 'forces': 338, 'place': 664, 'finally': 322, 'each': 264, 'order': 641, 'country': 197, 'prince': 684, 'unfortunately': 927, 'red': 716, 'well': 956, 'among': 53, 'mysterious': 602, 'british': 137, 'human': 429, 'race': 704, 'group': 382, 'heads': 398, 'die': 236, 'or': 640, 'music': 600, 'scene': 754, 'alice': 40, 'band': 88, 'black': 117, 'writer': 990, 'century': 162, 'francisco': 345, 'doing': 250, 'every': 289, 'brought': 140, 'we': 953, 'enough': 278, 'thing': 879, 'anything': 62, 'husband': 431, 'children': 172, 'uncle': 925, 'chris': 173, 'difficult': 240, 'any': 60, 'although': 49, 'care': 156, 'deal': 222, 'hired': 412, 'full': 354, 'support': 845, 'latest': 501, 'attempt': 80, 'private': 687, 'killing': 485, 'larry': 497, 'receives': 714, 'returns': 728, 'trouble': 911, 'th': 868, 'i': 432, 'military': 578, 'special': 812, 'team': 859, 'led': 513, 'officer': 630, 'mission': 583, 'travel': 905, 'left': 515, 'former': 341, 'quickly': 702, 'discovers': 243, 'long': 530, 'tommy': 895, 'manager': 551, 'investigate': 447, 'face': 298, 'fight': 317, 'rocky': 736, 'billy': 115, 'boat': 121, 'captain': 154, 'crew': 201, 'join': 472, 'bobby': 123, 'recently': 715, 'met': 572, 'behind': 104, 'lose': 536, 'future': 356, 'another': 59, 'slowly': 799, 'few': 315, 'try': 915, 'seemingly': 767, 'game': 357, 'pregnant': 681, 'older': 633, 'player': 670, 'side': 792, 'missing': 582, 'student': 837, 'realize': 710, 'dark': 212, 'de': 219, 'released': 720, 'prison': 686, 'dog': 249, 'ben': 108, 'found': 343, 'things': 880, 'seem': 766, 'start': 818, 'department': 228, 'protect': 694, 'daniel': 210, 'finding': 324, 'hard': 391, 'beautiful': 94, 'gang': 358, 'hell': 401, 'further': 355, 'spirit': 814, 'show': 790, 'around': 68, 'high': 409, 'power': 679, 'deep': 227, 'forever': 339, 'knowing': 490, 'teenager': 862, 'hands': 387, 'several': 780, 'number': 623, 'assigned': 76, 'investigation': 448, 'call': 148, 'doctor': 245, 'building': 142, 'follows': 332, 'wedding': 955, 'issues': 454, 'coming': 187, 'dr': 254, 'caught': 160, 'crime': 202, 'mental': 571, 'important': 437, 'seems': 768, 'starts': 819, 'murders': 599, 'true': 912, 'control': 192, 'chicago': 168, 'looks': 533, 'ago': 35, 'affair': 29, 'follow': 330, 'realizes': 711, 'trip': 910, 'jim': 466, 'parents': 650, 'criminal': 203, 'running': 744, 'line': 521, 'eventually': 287, 'refuses': 717, 'becoming': 98, 'ultimately': 924, 'identity': 434, 'late': 499, 'university': 929, 'such': 841, 'lover': 541, 'england': 276, 'battle': 92, 'cause': 161, 'dangerous': 209, 'child': 170, 'called': 149, 'travels': 907, 'search': 758, 'gold': 377, 'camp': 151, 'danger': 208, 'land': 494, 'sheriff': 785, 'past': 655, 'us': 934, 'project': 693, 'many': 552, 'final': 321, 'large': 495, 'due': 261, 'fire': 326, 'earth': 266, 'states': 821, 'days': 218, 'scientist': 756, 'government': 380, 'lee': 514, 'susan': 848, 'research': 723, 'god': 374, 'boss': 128, 'destroy': 232, 'paul': 656, 'paris': 651, 'french': 348, 'flight': 329, 'cold': 181, 'self': 771, 'else': 271, 'second': 759, 'director': 241, 'english': 277, 'sex': 781, 'leading': 506, 'actress': 24, 'plays': 672, 'process': 690, 'change': 164, 'professional': 691, 'personal': 661, 'professor': 692, 'wanted': 946, 'need': 608, 'reason': 713, 'revenge': 729, 'thus': 888, 'richard': 731, 'made': 544, 'interest': 445, 'mexico': 573, 'texas': 867, 'fall': 300, 'kate': 476, 'state': 820, 'hospital': 422, 'secret': 760, 'involved': 450, 'romantic': 739, 'feelings': 311, 'queen': 699, 'army': 67, 'ray': 706, 'danny': 211, 'twenty': 921, 'anna': 58, 'already': 47, 'bill': 114, 'prove': 695, 'reality': 709, 'suicide': 843, 'based': 91, 'upon': 933, 'unknown': 930, 'art': 72, 'north': 619, 'boyfriend': 131, 'nothing': 621, 'given': 370, 'months': 586, 'live': 523, 'pay': 657, 'childhood': 171, 'war': 948, 'seeks': 765, 'door': 252, 'inside': 443, 'contact': 191, 'half': 385, 'problem': 688, 'king': 488, 'dream': 255, 'return': 727, 'hires': 413, 'isn': 453, 'loses': 537, 'agent': 34, 'known': 491, 'america': 51, 'keep': 477, 'looking': 532, 'blue': 119, 'wild': 973, 'traveling': 906, 'younger': 999, 'brings': 136, 'together': 892, 'cannot': 153, 'forced': 337, 'major': 546, 'max': 561, 'asks': 75, 'invites': 449, 'visit': 943, 'times': 890, 'alien': 41, 'attack': 79, 'far': 305, 'lost': 538, 'tough': 900, 'space': 811, 'class': 177, 'teenage': 861, 'feels': 312, 'estate': 283, 'buy': 145, 'rich': 730, 'vacation': 939, 'stranger': 833, 'bar': 90, 'short': 787, 'johnny': 471, 'helen': 400, 'less': 516, 'happy': 390, 'hotel': 423, 'detective': 233, 'john': 470, 'dealer': 223, 'sure': 846, 'talk': 857, 'arrested': 69, 'telling': 864, 'goal': 373, 'heart': 399, 'won': 983, 'lucy': 543, 'used': 936, 'eve': 284, 'tom': 894, 'toward': 901, 'perfect': 659, 'alex': 39, 'hit': 416, 'ann': 57, 'island': 452, 'sam': 748, 'master': 559, 'system': 850, 'current': 205, 'social': 802, 'quest': 700, 'hope': 420, 'coach': 180, 'college': 182, 'leader': 505, 'journey': 474, 'documentary': 246, 'point': 674, 'rock': 735, 'jimmy': 467, 'jeff': 464, 'writing': 991, 'couple': 198, 'streets': 835, 'bond': 125, 'relationships': 719, 'cop': 195, 'desert': 229, 'tale': 856, 'everyone': 290, 'sent': 774, 'soldiers': 804, 'princess': 685, 'suddenly': 842, 'think': 881, 'too': 897, 'romance': 738, 'escape': 280, 'breaks': 134, 'evidence': 292, 'mike': 577, 'club': 179, 'violent': 942, 'joe': 469, 'blood': 118, 'part': 652, 'escapes': 281, 'friendship': 351, 'star': 817, 'drugs': 260, 'gives': 371, 'hours': 424, 'dreams': 256, 'figure': 319, 'computer': 190, 'rescue': 722, 'lord': 534, 'often': 631, 'miss': 581, 'adam': 26, 'singer': 794, 'popular': 677, 'uses': 937, 'ted': 860, 'events': 286, 'peter': 663, 'henry': 404, 'hunter': 430, 'plane': 666, 'open': 638, 'steve': 825, 'party': 654, 'stage': 815, 'trial': 908, 'wrong': 992, 'famous': 304, 'stories': 830, 'once': 635, 'took': 898, 'successful': 840, 'deadly': 221, 'mark': 553, 'question': 701, 'success': 839, 'public': 696, 'alive': 42, 'free': 347, 'problems': 689, 'course': 199, 'hero': 406, 'cat': 159, 'harry': 392, 'attempts': 81, 'mary': 558, 'security': 762, 'lot': 539, 'arrives': 71, 'birthday': 116, 'reporter': 721, 'act': 21, 'assistant': 77, 'history': 415, 'opportunity': 639, 'innocent': 442, 'almost': 44, 'united': 928, 'air': 37, 'service': 776, 'dance': 207, 'lady': 493, 'turned': 918, 'students': 838, 'born': 127, 'lonely': 529, 'desperate': 230, 'eyes': 297, 'driver': 258, 'court': 200, 'charles': 166, 'enemy': 275, 'david': 216, 'alan': 38, 'general': 360, 'whether': 963, 'society': 803, 'matt': 560, 'struggling': 836, 'falling': 301, 'station': 822, 'force': 336, 'artist': 73, 'fighting': 318, 'jane': 462, 'spend': 813, 'christmas': 174, 'nick': 616, 'share': 783, 'joins': 473, 'hidden': 408, 'our': 644, 'community': 188, 'jerry': 465, 'water': 950, 'feel': 310, 'moves': 592, 'political': 676, 'dying': 263, 'pete': 662, 'light': 519, 'rest': 725, 'james': 461, 'sarah': 751, 'offer': 627, 'partner': 653, 'tony': 896, 'begin': 101, 'plot': 673, 'planet': 667, 'colonel': 183, 'hold': 417, 'hopes': 421, 'german': 362, 'largely': 496, 'present': 682, 'rose': 741, '&': 3, 'william': 975, 'dave': 215, 'food': 333, 'sexual': 782, 'bob': 122, 'charlie': 167, 'japanese': 463, 'maggie': 545, 'scott': 757}

    cols = ['p_Action', 'p_Adventure', 'p_Animation', 'p_Biography', 'p_Comedy', 'p_Crime', 'p_Documentary', 'p_Drama', 'p_Family', 'p_Fantasy', 'p_Film-Noir', 'p_History', 'p_Horror', 'p_Music', 'p_Musical', 'p_Mystery', 'p_News', 'p_Romance', 'p_Sci-Fi', 'p_Short', 'p_Sport', 'p_Thriller', 'p_War', 'p_Western']


    vectorizr=CountVectorizer(vocabulary=vocabulario)

    X_test=vectorizr.transform(plot)


    # Make prediction
    prediccion = clf.predict_proba(X_test)
    generos = dict(zip(cols, prediccion[0]))
    
    
    resource_fields = {
    'p_Action': fields.String,
    'p_Adventure' : fields.String,
    'p_Animation' : fields.String,
    'p_Biography' : fields.String,
    'p_Comedy' : fields.String,
    'p_Crime' : fields.String,
    'p_Documentary' : fields.String,
    'p_Drama' : fields.String,
    'p_Family' : fields.String,
    'p_Fantasy' : fields.String,       
    'p_Film-Noir' : fields.String,
    'p_History' : fields.String,
    'p_Horror' : fields.String,
    'p_Music' : fields.String,
    'p_Mystery' : fields.String,
    'p_News' : fields.String,
    'p_Romance' : fields.String,
    'p_Sci-Fi' : fields.String,
    'p_Short' : fields.String,
    'p_Sport' : fields.String,
    'p_Thriller' : fields.String,
    'p_War' : fields.String,
    'p_Western' : fields.String
    }
    result=marshal(generos, resource_fields)
    
    return generos


if __name__ == "__main__":
    
    if len(sys.argv) == 1:
        print('Please add a plot')
        
    else:

        plot = sys.argv[1]


        generos = predice_GENEROS(plot)
        print(generos)
